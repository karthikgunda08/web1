import{u as l,a as m,R as u,j as e,L as p}from"./index-e439054e.js";import{C as f,R as y,A as x,a as h}from"./constants-81f60586.js";import{a as j}from"./authService-2d4415af.js";import{M as g,a as w,b as C,c as N}from"./Modal-78058900.js";import{B as R}from"./Button-fcf173b3.js";const b=async(t,s,a)=>j("/payments/create-credit-order",{method:"POST",body:JSON.stringify({creditPackId:t,amount:s,currency:a})}),S=async({currentUser:t,creditPack:s,onPaymentSuccess:a,onPaymentError:o,onModalDismiss:d})=>{if(!window.Razorpay){console.error("Razorpay SDK not loaded. Please check your internet connection or refresh the page."),o(new Error("Razorpay SDK not loaded."));return}try{const r=await b(s.id,s.price,f);if(!r||!r.id)throw new Error("Invalid order response from server.");const c={key:y,amount:r.amount,currency:r.currency,name:x,description:`Purchase of ${s.name} (${s.credits} credits)`,order_id:r.id,handler:i=>{a(i)},prefill:{name:t.name||t.email.split("@")[0]||"Dakshin Vaarahi User",email:t.email},notes:{userId:t.id,creditPackId:s.id},theme:{color:"#4C1D95"},modal:{ondismiss:()=>{d&&d()}}},n=new window.Razorpay(c);n.on("payment.failed",function(i){console.error("Razorpay Payment Failed:",i.error),o(i.error)}),n.open()}catch(r){console.error("Error initiating Razorpay payment:",r),o(r)}},P=({pack:t,onSelect:s,isLoading:a})=>e.jsxs("div",{className:"p-4 bg-slate-700/50 rounded-lg border border-slate-600",children:[e.jsxs("h3",{className:"font-bold text-lg text-primary",children:[t.credits.toLocaleString()," ",e.jsx("span",{className:"text-sm font-normal text-slate-300",children:"Credits"})]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:t.description}),e.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[e.jsxs("p",{className:"text-xl font-semibold text-white",children:["â‚¹",t.price.toLocaleString("en-IN")]}),e.jsx(R,{onClick:s,disabled:a,children:"Buy Now"})]})]}),L=({isOpen:t,onClose:s})=>{const{currentUser:a}=l(),{addNotification:o}=m(),[d,r]=u.useState(!1),c=async n=>{if(!a){o("You must be logged in to buy credits.","error");return}r(!0),await S({currentUser:a,creditPack:n,onPaymentSuccess:()=>{o("Payment successful! Your credits will be updated shortly.","success"),r(!1),s(),setTimeout(()=>l.getState().refreshCurrentUser(),2e3)},onPaymentError:i=>{o(`Payment failed: ${i.message||"An unknown error occurred."}`,"error"),r(!1)},onModalDismiss:()=>{o("Payment was cancelled.","info"),r(!1)}})};return t?e.jsxs(g,{onClose:s,children:[e.jsxs(w,{children:[e.jsx(C,{children:"Buy AI Credits"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose a credit pack to fuel your architectural creations."})]}),e.jsxs(N,{className:"space-y-4",children:[d&&e.jsxs("div",{className:"absolute inset-0 bg-card/80 flex flex-col items-center justify-center",children:[e.jsx(p,{}),e.jsx("p",{className:"mt-2 text-sm",children:"Redirecting to payment gateway..."})]}),h.map(n=>e.jsx(P,{pack:n,onSelect:()=>c(n),isLoading:d},n.id))]})]}):null};export{L as default};
