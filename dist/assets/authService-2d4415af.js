import{B as h}from"./constants-81f60586.js";let f=null,u=null;const d=e=>{f=e},w=()=>f,c=async(e,t={})=>{const n=async o=>{const a=w(),r=new Headers(o.headers||{});!(o.body instanceof FormData)&&!r.has("Content-Type")&&r.set("Content-Type","application/json"),a&&r.set("Authorization",`Bearer ${a}`);const l={...o,headers:r,credentials:"include"};return fetch(`${h}${e}`,l)};let s=await n(t);if(s.status===401&&!new Headers(t.headers).get("X-Retry")){u||(u=(async()=>{try{const r=await fetch(`${h}/auth/refresh-token`,{method:"POST",credentials:"include"});if(!r.ok)throw new Error("Session expired");const{token:l}=await r.json();return d(l),l}finally{u=null}})()),await u;const o=new Headers(t.headers);o.set("X-Retry","true");const a={...t,headers:o};s=await n(a)}if(!s.ok){if(s.status===401)throw p(),window.location.hash="/",new Error("Your session has expired. Please log in again.");const o=await s.json().catch(()=>({message:`Request failed with status ${s.status}`})),a=new Error(o.message||`Request failed with status ${s.status}`);throw a.status=s.status,a}if(s.status===204)return null;const i=s.headers.get("content-type");return i&&(i.indexOf("application/dxf")!==-1||i.indexOf("application/octet-stream")!==-1||i.indexOf("application/pdf")!==-1)?s.blob():i&&i.indexOf("application/json")!==-1?s.json():s.text()},g=async(e,t)=>{const n=await c(`/auth/reset-password/${e}`,{method:"POST",body:JSON.stringify({password:t})});return n.token&&d(n.token),n},p=async()=>{try{await c("/auth/logout",{method:"POST"})}catch(e){console.error("Logout failed, clearing token locally.",e)}finally{d(null)}},m=async e=>c("/auth/me",{method:"PUT",body:JSON.stringify(e)}),k=async e=>c("/auth/me/change-password",{method:"POST",body:JSON.stringify(e)}),P=async e=>{const t=await fetch(`${h}/projects/public/${e}`);if(!t.ok){const n=await t.json();throw new Error(n.message||"Could not fetch project.")}return t.json()},j=async e=>{const t=await fetch(`${h}/projects/folio/${e}`);if(!t.ok){const n=await t.json();throw new Error(n.message||"Could not fetch folio.")}return t.json()},O=async()=>c("/auth/me/api-key",{method:"POST"});export{c as a,P as b,k as c,j as d,O as g,g as r,m as u};
