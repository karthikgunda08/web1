import{r as l,a as G,j as e,R as P,L as C}from"./index-e439054e.js";import{P as q,Q as E}from"./geminiService-f982c15c.js";import"./constants-81f60586.js";import"./authService-2d4415af.js";const T=({current:p})=>{const n=[{id:"prompt",name:"Your Idea"},{id:"clarify",name:"Add Details"},{id:"generate",name:"AI Generation"},{id:"result",name:"Review Concept"}],i=n.findIndex(r=>r.id===p);return e.jsx("div",{className:"flex items-center justify-center mb-6",children:n.map((r,a)=>e.jsxs(P.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center transition-colors ${a<=i?"bg-amber-500 text-white":"bg-slate-700 text-slate-400"}`,children:a<i?"✓":a+1}),e.jsx("p",{className:`text-xs mt-1 transition-colors ${a<=i?"text-amber-300":"text-slate-400"}`,children:r.name})]}),a<n.length-1&&e.jsx("div",{className:`flex-1 h-0.5 mx-2 transition-colors ${a<i?"bg-amber-500":"bg-slate-700"}`})]},r.id))})},F=p=>{const{onClose:n,onApplyConcept:i,currentUser:r,setBuyCreditsModalOpen:a,refreshCurrentUser:k,currentProject:o}=p,[g,x]=l.useState("prompt"),[c,A]=l.useState("A 2bhk vastu home for a small family."),[b,S]=l.useState([]),[j,w]=l.useState({}),[y,u]=l.useState(!1),[v,h]=l.useState(null),[d,N]=l.useState(null),{addNotification:m}=G(),I=(t,s)=>{w(f=>({...f,[t]:s}))},L=async()=>{if(c.trim()){u(!0),h(null);try{const t=await q((o==null?void 0:o.id)||"",c);S(t);const s=t.reduce((f,$)=>({...f,[$.key]:""}),{});w(s),x("clarify")}catch(t){h(t.message),m(t.message,"error")}finally{u(!1)}}},R=async()=>{if(!r){m("Please log in to use this feature.","error");return}if(r.role!=="owner"&&r.credits<100){m(`You need 100 credits. You have ${r.credits}.`,"info"),a(!0);return}u(!0),x("generate"),h(null),N(null);const t=[c,...b.map(s=>`${s.question}
- ${j[s.key]||"Not specified."}`)].join(`

`);try{const s=await E((o==null?void 0:o.id)||"",t);N(s),x("result"),m("Master Architect has generated a full project concept!","success"),await k()}catch(s){h(s.message||"An unexpected error occurred."),m(s.message,"error"),x("clarify")}finally{u(!1)}},D=()=>{d&&(i(d),n())},M=()=>{switch(g){case"prompt":return e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-center mb-2",children:"What's on your mind?"}),e.jsx("p",{className:"text-sm text-slate-300 mb-4 text-center",children:"Start with a simple idea. The AI will ask for more details next."}),e.jsx("textarea",{value:c,onChange:t=>A(t.target.value),rows:4,className:"w-full p-3 border border-slate-600 rounded-md bg-slate-700 text-slate-100 focus:ring-2 focus:ring-amber-500",placeholder:"e.g., 'A modern G+1 Vastu home' or 'एक आधुनिक जी+1 वास्तु घर'",autoFocus:!0}),e.jsx("button",{onClick:L,disabled:y||!c.trim(),className:"w-full mt-4 px-4 py-3 text-white font-semibold rounded-md disabled:opacity-50 flex items-center justify-center transition-all bg-amber-600 hover:bg-amber-500",children:y?e.jsx(C,{size:"h-5 w-5"}):"Next: Add Details"})]});case"clarify":return e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-center mb-2",children:"Let's refine the vision."}),e.jsx("p",{className:"text-sm text-slate-300 mb-4 text-center",children:"The AI suggests these questions to create a better design."}),e.jsx("div",{className:"space-y-4",children:b.map(t=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:t.question}),e.jsx("input",{type:"text",value:j[t.key],onChange:s=>I(t.key,s.target.value),className:"w-full p-2 bg-slate-700 border border-slate-600 rounded-md",placeholder:t.placeholder})]},t.key))}),e.jsx("button",{onClick:R,className:"w-full mt-6 px-4 py-3 text-white font-semibold rounded-md disabled:opacity-50 flex items-center justify-center transition-all bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700",children:"Generate Concept (100 credits)"})]});case"generate":return e.jsxs("div",{className:"text-center p-8",children:[e.jsx(C,{size:"h-12 w-12",color:"text-amber-400"}),e.jsx("h3",{className:"text-xl font-semibold mt-4",children:"Generating Master Concept..."}),e.jsx("p",{className:"text-sm text-slate-400",children:"The AI is creating a floor plan, running structural analysis, checking Vastu, and generating a preview render. This may take a moment."})]});case"result":return e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-center mb-2",children:"Concept Ready for Review"}),d&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:d.previewRender.imageUrl,alt:"AI generated preview",className:"w-full rounded-lg shadow-lg my-2"}),e.jsx("p",{className:"text-sm text-slate-300",children:d.summary})]}),e.jsx("button",{onClick:D,className:"w-full mt-4 px-4 py-3 font-semibold bg-emerald-600 hover:bg-emerald-500 text-white rounded-md",children:"Apply this Concept to Editor"})]})]})}};return e.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-75 flex items-center justify-center z-[100]",onClick:n,children:e.jsxs("div",{className:"bg-slate-800 p-6 md:p-8 rounded-xl shadow-2xl w-full max-w-2xl m-4 flex flex-col max-h-[90vh]",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 flex-shrink-0",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-300",children:"AI Design Dialogue"}),e.jsx("button",{onClick:n,className:"text-slate-400 hover:text-sky-300 transition-colors","aria-label":"Close modal",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-7 h-7",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx(T,{current:g}),e.jsxs("div",{className:"flex-grow overflow-y-auto pr-2",children:[v&&e.jsx("p",{className:"text-red-400 text-xs mt-2 text-center bg-red-900/50 p-2 rounded-md mb-4",children:v}),M()]})]})})};export{F as default};
